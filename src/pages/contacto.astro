---
import MainLayout from '../layouts/MainLayout.astro';
---

<MainLayout title="Contacto - Servicios de Desarrollo de IA">
  <!-- Agregar Breadcrumbs para mejorar la navegación -->
  <div class="py-3 px-4 w-full max-w-7xl mx-auto">
    <ol class="flex flex-wrap items-center space-x-1 text-sm">
      <li>
        <a href="/" class="hover:text-accent transition-colors">Inicio</a>
      </li>
      <li class="flex items-center">
        <svg class="w-4 h-4 text-text-secondary/50 mx-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
        <span class="text-accent font-medium" aria-current="page">Contacto</span>
      </li>
    </ol>
  </div>
  <div class="container mx-auto grid md:grid-cols-2 gap-12 items-start">
    <section class="bg-surface/80 backdrop-blur-xl border-2 border-accent/40 rounded-3xl shadow-lg p-10 animate-fade-in">
      <h1 class="text-4xl font-bold mb-6 text-text-primary">Contáctanos</h1>
      <p class="text-text-secondary mb-8">
        ¿Listo para transformar tu negocio con inteligencia artificial? Comienza tu journey con nosotros rellenando el siguiente formulario.
      </p>
      
      <form id="contactForm" class="space-y-6" novalidate>
        <div class="form-group">
          <label for="name" class="block mb-2 text-text-accent">Nombre completo <span class="text-red-500">*</span></label>
          <div class="relative">
            <input 
              type="text" 
              id="name" 
              name="name"
              required 
              class="w-full px-4 py-3 rounded-3xl bg-card text-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-accent transition pr-10 validation-input"
              placeholder="Su nombre completo"
              aria-required="true"
              data-error-message="Por favor ingrese su nombre completo"
            />
            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none success-icon hidden text-green-500">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
            </div>
            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none error-icon hidden text-red-500">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
          </div>
          <p class="mt-1 text-sm text-red-500 error-message hidden"></p>
        </div>
        
        <div class="grid md:grid-cols-2 gap-4">
          <div class="form-group">
            <label for="email" class="block mb-2 text-text-accent">Correo Electrónico <span class="text-red-500">*</span></label>
            <div class="relative">
              <input 
                type="email" 
                id="email" 
                name="email"
                required 
                class="w-full px-4 py-3 rounded-3xl bg-card text-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-accent transition pr-10 validation-input"
                placeholder="nombre@empresa.com"
                aria-required="true"
                data-error-message="Por favor ingrese un correo electrónico válido"
              />
              <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none success-icon hidden text-green-500">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
              </div>
              <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none error-icon hidden text-red-500">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
              </div>
            </div>
            <p class="mt-1 text-sm text-red-500 error-message hidden"></p>
          </div>
          <div>
            <label for="phone" class="block mb-2 text-text-accent">Teléfono <span class="text-sm text-gray-400">(opcional)</span></label>
            <input 
              type="tel" 
              id="phone" 
              name="phone"
              class="w-full px-4 py-3 rounded-3xl bg-card text-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-accent transition"
              placeholder="+58 412 123 4567"
            />
          </div>
        </div>
        
        <div>
          <label for="subject" class="block mb-2 text-text-accent">Asunto</label>
          <input 
            type="text" 
            id="subject" 
            name="subject"
            class="w-full px-4 py-3 rounded-3xl bg-card text-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-accent transition"
            placeholder="¿En qué podemos ayudarte?"
          />
        </div>

        <div>
          <label for="email" class="block mb-2 text-text-accent">Correo Electrónico</label>
          <input 
            type="email" 
            id="email" 
            name="email"
            required 
            class="w-full px-4 py-3 rounded-3xl bg-card text-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-accent transition"
            placeholder="nombre@empresa.com"
          />
        </div>

        <div>
          <label for="company" class="block mb-2 text-text-accent">Empresa</label>
          <input 
            type="text" 
            id="company" 
            name="company"
            class="w-full px-4 py-3 rounded-3xl bg-card text-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-accent transition"
            placeholder="Nombre de su empresa (opcional)"
          />
        </div>

        <div>
          <label for="service" class="block mb-2 text-text-accent">Servicio de Interés</label>
          <select 
            id="service" 
            name="service"
            class="w-full px-4 py-3 rounded-3xl bg-card text-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-accent transition"
          >
            <option value="">Seleccione un servicio</option>
            <option value="software-ai">Desarrollo de Software de IA</option>
            <option value="ai-solutions">Soluciones de IA Especializadas</option>
            <option value="consulting">Consultoría en IA</option>
            <option value="algorithm-audit">Auditoría de Algoritmos</option>
            <option value="mlops">Transformación MLOps</option>
            <option value="other">Otro</option>
          </select>
        </div>

        <div>
          <label for="message" class="block mb-2 text-text-accent">Descripción del Proyecto</label>
          <textarea 
            id="message" 
            name="message"
            rows="5" 
            required 
            class="w-full px-4 py-3 rounded-3xl bg-card text-white placeholder:text-gray-400 focus:outline-none focus:ring-2 focus:ring-accent transition"
            placeholder="Cuéntenos más sobre su proyecto o necesidad de IA..."
          ></textarea>
        </div>

        <button 
          type="submit" 
          class="w-full bg-accent hover:bg-accent/80 text-white font-bold py-3 rounded-3xl shadow-lg transition"
        >
          Enviar Mensaje
        </button>
      </form>
    </section>

    <section class="space-y-8">
      <div class="bg-card rounded-3xl shadow-lg p-8">
        <h2 class="text-2xl md:text-3xl font-bold tracking-wide mb-4 text-accent">Información de Contacto</h2>
        <div class="space-y-4 text-text-secondary">
          <div class="flex items-center space-x-4">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
            </svg>
            <span>contacto@gorankfirst.com</span>
          </div>
          <div class="flex items-center space-x-4">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h3m-3-8a5 5 0 01-5 5v0a5 5 0 01-5-5v-2a5 5 0 015-5v0a5 5 0 015 5v2z" />
            </svg>
            <span>+58 (412) 6074572</span>
          </div>
          <div class="flex items-center space-x-4">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" />
            </svg>
            <span>Torre Exa, Piso 8 Oficina 808, El Rosal, Caracas - Venezuela</span>
          </div>
        </div>
      </div>

      <div class="bg-card rounded-3xl shadow-lg p-8">
        <h2 class="text-2xl font-bold mb-4 text-text-accent">Horario de Atención</h2>
        <div class="text-text-secondary">
          <div class="flex justify-between mb-2">
            <span>Lunes - Viernes</span>
            <span>9:00 AM - 6:00 PM</span>
          </div>
          <div class="flex justify-between">
            <span>Sábado</span>
            <span>10:00 AM - 2:00 PM</span>
          </div>
          <div class="text-sm text-text-secondary mt-4 italic">
            Respondemos a consultas dentro de las 24 horas hábiles.
          </div>
        </div>
      </div>

      <div class="bg-card rounded-3xl shadow-lg p-8">
        <h2 class="text-2xl font-bold mb-4 text-text-accent">Política de Privacidad</h2>
        <p class="text-text-secondary">
          Nos comprometemos a proteger su información personal. Toda la información proporcionada será tratada con la máxima confidencialidad.
        </p>
      </div>
    </section>
  </div>
</MainLayout>

<script>
  document.addEventListener('astro:page-load', () => {
    const form = document.getElementById('contactForm');
    const submitBtn = form?.querySelector('button[type="submit"]');
    const originalBtnText = submitBtn?.textContent || 'Enviar mensaje';
    const validationInputs = document.querySelectorAll('.validation-input');
    
    if (!form) return;
    
    // Función para validar un campo individual
    function validateField(field) {
      const parent = field.closest('.form-group');
      const errorMessage = parent.querySelector('.error-message');
      const successIcon = parent.querySelector('.success-icon');
      const errorIcon = parent.querySelector('.error-icon');
      const customErrorMessage = field.dataset.errorMessage || 'Este campo es requerido';
      
      let isValid = field.checkValidity();
      
      // Validación personalizada para email
      if (field.type === 'email' && field.value) {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        isValid = emailRegex.test(field.value);
      }
      
      if (!isValid && field.value) {
        // Campo inválido pero con valor
        field.classList.add('border-red-500');
        field.classList.remove('border-green-500');
        errorMessage.textContent = customErrorMessage;
        errorMessage.classList.remove('hidden');
        errorIcon.classList.remove('hidden');
        successIcon.classList.add('hidden');
        return false;
      } else if (!field.value && field.required) {
        // Campo vacío pero requerido
        field.classList.add('border-red-500');
        field.classList.remove('border-green-500');
        errorMessage.textContent = 'Este campo es requerido';
        errorMessage.classList.remove('hidden');
        errorIcon.classList.remove('hidden');
        successIcon.classList.add('hidden');
        return false;
      } else if (field.value) {
        // Campo válido con valor
        field.classList.remove('border-red-500');
        field.classList.add('border-green-500');
        errorMessage.classList.add('hidden');
        errorIcon.classList.add('hidden');
        successIcon.classList.remove('hidden');
        return true;
      } else {
        // Campo no requerido y vacío
        field.classList.remove('border-red-500');
        field.classList.remove('border-green-500');
        errorMessage.classList.add('hidden');
        errorIcon.classList.add('hidden');
        successIcon.classList.add('hidden');
        return true;
      }
    }
    
    // Validar todos los campos del formulario
    function validateForm() {
      let isFormValid = true;
      
      validationInputs.forEach(input => {
        const isFieldValid = validateField(input);
        if (!isFieldValid) {
          isFormValid = false;
        }
      });
      
      return isFormValid;
    }
    
    // Añadir event listeners a cada campo para validación en tiempo real
    validationInputs.forEach(input => {
      ['blur', 'input'].forEach(eventType => {
        input.addEventListener(eventType, () => validateField(input));
      });
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      // Validar el formulario antes de enviar
      const isValid = validateForm();
      
      if (!isValid) {
        // Scroll al primer campo con error
        const firstErrorField = form.querySelector('.validation-input.border-red-500');
        if (firstErrorField) {
          firstErrorField.focus();
          firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
        return;
      }
      
      // Deshabilitar el botón de envío
      if (submitBtn) {
        submitBtn.disabled = true;
        submitBtn.innerHTML = `
          <svg class="animate-spin -ml-1 mr-2 h-5 w-5 text-white inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          Enviando...
        `;
      }

      try {
        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());
        
        // Validar campos requeridos
        const requiredFields = ['name', 'email', 'message'];
        const missingFields = requiredFields.filter(field => !data[field]);
        
        if (missingFields.length > 0) {
          alert(`Por favor complete los siguientes campos: ${missingFields.join(', ')}`);
          return;
        }

        // Enviar datos a la API
        const response = await fetch('/api/contact', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(data)
        });

        const result = await response.json();

        if (result.success) {
          // Mostrar mensaje de éxito
          const successAlert = document.createElement('div');
          successAlert.className = 'mt-4 p-4 bg-green-500/10 border border-green-500/30 text-green-400 rounded-lg';
          successAlert.innerHTML = `
            <div class="flex items-center">
              <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
              ¡Mensaje enviado con éxito! Nos pondremos en contacto contigo pronto.
            </div>
          `;
          form.prepend(successAlert);
          form.reset();
        } else {
          throw new Error(result.error || 'Error al enviar el mensaje');
        }
      } catch (error) {
        console.error('Error:', error);
        alert('Hubo un error al enviar el mensaje. Por favor, inténtalo de nuevo más tarde.');
      } finally {
        // Restaurar el botón
        if (submitBtn) {
          submitBtn.disabled = false;
          submitBtn.textContent = originalBtnText;
        }
      }
    });
  });
</script>
